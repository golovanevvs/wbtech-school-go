services:
  image-processor_main-server:
    image: ghcr.io/golovanevvs/image-processor_main-server:${APP_VERSION:-latest}
    container_name: ${APP_CONTAINER}
    environment:
      - ENV=prod
      - APP_TRANSPORT_HTTP_PUBLIC_HOST=https://${PUBLIC_HOST_DOCKER}/${APP_CONTAINER}
      - APP_TRANSPORT_HTTP_WEB_PUBLIC_HOST=https://${PUBLIC_HOST_DOCKER}/${WEB_CLIENT_CONTAINER}
      - APP_TRANSPORT_HTTP_PORT=${APP_TRANSPORT_HTTP_PORT}
      - APP_REPOSITORY_FILE_STORAGE_DIR=${APP_REPOSITORY_FILE_STORAGE_DIR}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_SSLMODE=${POSTGRES_SSLMODE}
      - POSTGRES_MASTER_PORT=${POSTGRES_MASTER_PORT}
      - POSTGRES_MASTER_HOST=${POSTGRES_MASTER_HOST}
      - POSTGRES_DB=${POSTGRES_DB}
    volumes:
      - image-processor_storage:/root/resources/app/filestorage
    networks:
      - proxy
      - image-processor_main-server
    ports:
      - 7783:${APP_TRANSPORT_HTTP_PORT}

volumes:
  image-processor_storage:
    driver: local

networks:
  proxy:
    external: true
  image-processor_main-server:
    driver: bridge
    name: image-processor_main-server 