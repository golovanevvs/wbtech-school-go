# warehouse-control

Система управления складом с CRUD операциями, историей изменений и ролевой моделью доступа.

## Краткое описание

Warehouse Control — это веб-приложение для учёта товаров на складе с расширенными возможностями контроля и аудита. Система обеспечивает:

- **CRUD-операции с товарами** — добавление, просмотр, редактирование и удаление товаров;
- **Ролевую модель доступа** — разграничение прав для кладовщиков, менеджеров и аудиторов;
- **Историю изменений** — полное логирование всех операций с товарами;
- **Аудит действий** — отслеживание кто, что, когда и зачем изменил;
- **JWT авторизацию** — безопасную аутентификацию с access и refresh токенами.

## Технологии

**Frontend:**

- Next.js + React + TypeScript;
- Material-UI для интерфейса;
- Material React Table для отображения данных;
- JWT cookies для авторизации.

**Backend:**

- Go + Gin;
- PostgreSQL для базы данных;
- Триггеры в БД для логирования изменений;
- JWT для авторизации.

## Основные функции

### Управление товарами

- **Добавление товаров** — создание новых позиций с названием, ценой и количеством;
- **Просмотр товаров** — таблица всех товаров с полной информацией;
- **Редактирование** — изменение данных товаров (только для кладовщиков);
- **Удаление** — удаление товаров (только для кладовщиков);
- **Сортировка и фильтрация** — по различным полям таблицы.

### Ролевая модель доступа

Система поддерживает три уровня доступа:

1. **Кладовщик** — полный доступ (добавление, редактирование, удаление товаров);
2. **Менеджер** — просмотр и редактирование товаров;
3. **Аудитор** — только просмотр и доступ к истории изменений.

### История изменений

- **Полное логирование** — каждый товар хранит историю всех изменений;
- **Отслеживание авторства** — кто и когда внёс изменения;
- **Детализация изменений** — что именно было изменено;
- **Экспорт истории** — выгрузка истории в формате CSV для аудита.

### Авторизация и безопасность

- **JWT токены** — access и refresh токены для безопасной авторизации;
- **Хранение в cookies** — токены сохраняются в HTTP-only cookies;
- **Автоматическое обновление** — прозрачное обновление истёкших токенов;
- **Защищённые маршруты** — контроль доступа к страницам на основе ролей.

## Быстрый старт

### Тестовые аккаунты

Для удобства тестирования доступны предустановленные аккаунты:

- **Кладовщик:** `storekeeper` / `password` (полный доступ)
- **Менеджер:** `manager` / `password` (просмотр и редактирование)
- **Аудитор:** `auditor` / `password` (только просмотр и история)

### Основные страницы

- **Главная** (`/`) — список всех товаров с возможностью управления;
- **Вход** (`/auth`) — авторизация и регистрация пользователей;
- **Профиль** (`/profile`) — информация о текущем пользователе;
- **Добавление товара** (`/add-item`) — форма для создания новых позиций;
- **Редактирование товара** (`/edit-item`) — изменение существующих товаров;
- **История изменений** (`/history`) — детальная история изменений товара.

## Особенности реализации

### Антипаттерн триггеров

В рамках учебного задания для демонстрации антипаттернов реализовано логирование изменений через **триггеры в базе данных PostgreSQL**. В реальных проектах такой подход не рекомендуется из-за:

- Сложности отладки и тестирования;
- Связывания бизнес-логики с инфраструктурой БД;
- Проблем с производительностью при сложных операциях.

**Рекомендуемый подход:** реализация логирования в прикладном коде сервера.

### Архитектурные решения

- **Разделение ответственности** — чёткое разделение frontend и backend;
- **Контекст авторизации** — централизованное управление состоянием пользователя;
- **Защищённые маршруты** — контроль доступа на уровне компонентов;
- **Material Design** — современный и отзывчивый пользовательский интерфейс.

## API Endpoints

### Аутентификация

- `POST /auth/register` — регистрация нового пользователя
- `POST /auth/login` — вход в систему
- `POST /auth/refresh` — обновление токенов
- `GET /auth/me` — получение данных текущего пользователя
- `PUT /auth/update` — обновление данных пользователя
- `DELETE /auth/delete` — удаление пользователя
- `POST /auth/logout` — выход из системы

### Управление товарами

- `GET /items` — получение списка товаров
- `POST /items` — создание нового товара
- `GET /items/{id}` — получение товара по ID
- `PUT /items/{id}` — обновление товара
- `DELETE /items/{id}` — удаление товара
- `GET /items/{id}/history` — история изменений товара
- `GET /items/{id}/history/export` — экспорт истории в CSV
