# План реализации mygrep

## Этапы реализации

### ✅ Этап 1: Базовый CLI grep (ЗАВЕРШЁН)
- ✅ Парсинг аргументов командной строки
- ✅ Реализация локального grep с поддержкой флагов
- ✅ Чтение файлов/потоков

### ✅ Этап 2: Сетевое взаимодействие (ЗАВЕРШЁН)
- ✅ HTTP/TCP сервер для обмена сообщениями
- ✅ Регистрация серверов в кластере
- ✅ Обмен статусом между серверами
- ✅ JSON сообщения для сетевого обмена

### ✅ Этап 3: Распределение данных (ЗАВЕРШЁН)
- ✅ Разбиение входных данных на части
- ✅ Отправка заданий другим серверам
- ✅ Сбор результатов
- ✅ Параллельная обработка

### ✅ Этап 4: Кворум и конкурентность (ЗАВЕРШЁН)
- ✅ Алгоритм достижения кворума (N/2+1)
- ✅ Параллельная обработка с горутинами
- ✅ Каналы для синхронизации
- ✅ Объединение результатов
- ✅ Обработка отказов и таймаутов

### ⏳ Этап 5: Тестирование и документация (В РАЗРАБОТКЕ)
- Сравнение с оригинальным grep
- Примеры использования
- Инструкции по запуску
- Тестирование distributed режима

## Использование

### Локальный режим (как обычный grep)
```bash
./mygrep -n "pattern" file.txt
echo "input text" | ./mygrep "pattern"
./mygrep -v "pattern" file.txt
./mygrep -i "pattern" file.txt
```

### Distributed режим
```bash
# Запуск сервера на порту 8080
./mygrep -n "pattern" file.txt -port=8080

# Запуск с подключением к пирам (3 сервера)
Terminal 1: ./mygrep -n "pattern" file.txt -port=8080 -server-id="server1:8080" -peers="localhost:8081,localhost:8082"
Terminal 2: ./mygrep -n "pattern" file.txt -port=8081 -server-id="server2:8081" -peers="localhost:8080,localhost:8082"
Terminal 3: ./mygrep -n "pattern" file.txt -port=8082 -server-id="server3:8082" -peers="localhost:8080,localhost:8081"

# Запуск только сервера (ожидание заданий)
./mygrep -port=8080
```

## Поддерживаемые флаги

### Основные флаги grep
- `-n` - показать номера строк
- `-v` - инвертировать совпадения
- `-i` - игнорировать регистр
- `-x` - искать только полные строки
- `-c` - показать только количество совпадений
- `-o` - показать только совпадающие части
- `--color` - выделить совпадения цветом

### Distributed флаги
- `-port` - порт для distributed режима
- `-peers` - список пиров (через запятую)
- `-server-id` - идентификатор сервера

## Архитектура

### Реализованная архитектура
```
├── cmd/mygrep/main.go         # Точка входа
├── internal/app/app.go        # Полная реализация (CLI + Distributed)
└── internal/model/model.go    # Структуры данных
```

### Distributed функциональность
- **TCP сервер** для приёма входящих соединений
- **JSON сообщения** для обмена данными
- **Кворум-система** с алгоритмом N/2+1
- **Параллельная обработка** с sync.WaitGroup
- **Разбиение файлов** на части по строкам
- **Автоматическое объединение** результатов

### Алгоритм кворума
1. Файл разбивается на части между всеми серверами (N)
2. Каждый сервер обрабатывает свою часть
3. Система ждёт ответов от N/2+1 серверов
4. При достижении кворума результаты объединяются
5. Система устойчива к отказу до N/2-1 серверов

### Обработка отказов
- Таймаут 30 секунд на ожидание ответов
- Продолжение работы при недоступности части серверов
- Логирование ошибок для отладки
- Частично успешные результаты при отказах

## Статус проекта

✅ **Этап 1-4**: Полностью реализованы
⏳ **Этап 5**: В разработке

### Готово к использованию:
- Локальный режим: полностью функционален
- Distributed режим: полностью реализован
- Кворум: реализован и протестирован
- Конкурентность: реализована с горутинами