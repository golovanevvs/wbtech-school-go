# План реализации mygrep

1. Архитектура приложения

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Сервер 1      │    │   Сервер 2      │    │   Сервер N      │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │   Client    │ │◄──►│ │ Coordinator │ │◄──►│ │   Client    │ │
│ │   (CLI)     │ │    │ │  (Network)  │ │    │ │   (CLI)     │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │   Worker    │ │    │ │   Worker    │ │    │ │   Worker    │ │
│ │  (grep)     │ │    │ │  (grep)     │ │    │ │  (grep)     │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
└─────────────────┘    └─────────────────┘    └─────────────────┘

2. Этапы реализации

Этап 1: Базовый CLI grep

- Парсинг аргументов командной строки
- Реализация локального grep с поддержкой флагов
- Чтение файлов/потоков

Этап 2: Сетевое взаимодействие

- HTTP/TCP сервер для обмена сообщениями
- Регистрация серверов в кластере
- Обмен статусом между серверами

Этап 3: Распределение данных

- Разбиение входных данных на части
- Отправка заданий другим серверам
- Сбор результатов

Процесс распределения данных:

1. Инициализация кластера:

- Каждый сервер регистрируется в кластере
- Обменивается статусом с другими серверами
- Определяется общее количество серверов

2. Разбиение данных:

- Входной файл разбивается на части
- Каждый сервер получает задание (Job) с:
  - ID задания
  - Данными для обработки (часть файла)
  - Начальной и конечной строкой
  - Паттерном и флагами поиска

3. Параллельная обработка:

- часть данных с помощью grep
- Результаты собираются в структуру Result

Этап 4: Кворум и конкурентность

- Алгоритм достижения кворума (N/2+1): система ждёт ответов от `N/2 + 1` серверов (где `N` - общее количество серверов)
- Параллельная обработка с горутинами
- Каналы для синхронизации

Этап 5: Тестирование и документация

- Сравнение с оригинальным grep
- Примеры использования
- Инструкции по запуску

3. Использование

```bash
# Локальный режим (как обычный grep)
./mygrep -n "pattern" file.txt

# Распределённый режим
./mygrep -n "pattern" file.txt -peers="localhost:8081,localhost:8082" -port=8080
```

Параметры включают:

- `pattern` или `-e` - паттерн для поиска
- Флаги grep: `-n` (номера строк), `-v` (инвертированный поиск), `-i` (игнорировать регистр) и др.
- `peers` - список адресов других серверов в кластере
- `port` - порт текущего сервера

4. Ожидаемый результат

Утилита mygrep:

- Работает как обычный grep в локальном режиме
- Может запускаться в кластере серверов
- Автоматически распределяет нагрузку
- Достигает результата при отказе части серверов (благодаря кворуму)
- Поддерживает все основные флаги grep
